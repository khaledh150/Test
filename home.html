<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>Wonder Kids</title>
  <link href="https://fonts.googleapis.com/css?family=Nunito:700,400&display=swap" rel="stylesheet">
  <style>
    html,body {
      margin: 0; padding: 0; width: 100vw; height: 100vh;
      font-family: 'Nunito', Arial, sans-serif;
      background: #f6f7fa;
      overflow: hidden;
      --blue: #b4d7ff;
      --blue-dark: #263965;
      --blue-btn: #6cc2ff;
      --blue-light: #e4f1ff;
      --level-folded: #e4f1ff;
      --level-open: #b4d7ff;
      --chapter-selected: #fff3fb;
      --scrollbar: #93c2fa;
      --scrollbar-bg: transparent;
      --chapter-check: #28cb76;
      --dark-bg: #232347;
      --dark-top: #232347;
      --dark-card: #222234;
      --dark-level: #223255;
      --dark-blue: #2a3144;
      --dark-scroll: #435b89;
      --dark-btn: #273050;
      --dark-light: #30364a;
      --dark-chapter-selected: #342d38;
      --dark-chapter-row: #272643;
      --dark-text: #ffe066;
    }
    body {
      display: flex; flex-direction: column;
      width: 100vw; height: 100vh; min-height: 100vh;
      background: var(--bg, #f6f7fa);
    }
    body.dark {
      --bg: var(--dark-bg);
      --level-folded: var(--dark-level);
      --level-open: var(--blue-dark);
      --chapter-selected: var(--dark-chapter-selected);
      --scrollbar: var(--dark-scroll);
      --scrollbar-bg: transparent;
      --chapter-check: #28cb76;
      --top-bg: var(--dark-top);
      --card-bg: var(--dark-card);
      --level-bg: var(--dark-level);
      --btn-bg: var(--dark-btn);
      --text: var(--dark-text);
    }
    .fixed-top {
      width: 100vw; max-width: 100vw;
      min-height: 50vh; max-height: 50vh;
      background: var(--top-bg, #faf7fe);
      z-index: 3; position: relative;
      display: flex; flex-direction: column; align-items: center;
      box-shadow: 0 2px 18px #c7bae57a;
      transition: min-height .3s, background .3s;
      overflow: hidden;
    }
    .topbar-btns {
      position: absolute; top: 18px; right: 18px;
      display: flex; align-items: center; z-index: 10; gap: 13px;
    }
    .icon-btn {
      background: #e7f2ffcc; border-radius: 50%;
      width: 40px; height: 40px;
      border: none; display: flex; align-items: center; justify-content: center;
      box-shadow: 0 1px 7px #b993d62a;
      cursor: pointer; transition: background .17s, transform .11s;
    }
    .icon-btn:active { background: #6cc2ff; transform: scale(1.08);}
    .icon-btn svg { width: 25px; height: 25px; display: block; }
    .top-content-area {
      width: 99vw; max-width: 790px;
      margin: 65px auto 0 auto; border-radius: 17px;
      background: var(--card-bg,#fff);
      box-shadow: 0 2px 16px #b993d644;
      display: flex; flex-direction: column; align-items: center;
      transition: height .3s, background .3s;
      min-height: 260px; height: calc(50vh - 85px);
      overflow: hidden;
    }
    .top-title {
      text-align: center; font-size: 2rem;
      color: #8d79c9; font-weight: 700;
      margin: 8px 0 13px 0; letter-spacing: 0.03em;
      transition: color .2s;
    }
    body.dark .top-title { color: var(--dark-text);}
    .slideshow-img-area { width: 99%; min-height: 180px; max-height: 360px; display: flex; justify-content: center; align-items: center; margin: 0 0 15px 0; position: relative; overflow: hidden; }
    .slideshow-img { width: 100%; height: 220px; object-fit: cover; border-radius: 15px; box-shadow: 0 2px 16px #b993d624; opacity: 0; position: absolute; transition: opacity .7s cubic-bezier(.61,1.2,.61,.95), transform .6s; left: 0; top: 0; z-index: 1;}
    .slideshow-img.active { opacity: 1; z-index: 2; transform: scale(1.04);}
    .slideshow-dots { display: flex; gap: 9px; justify-content: center; margin: 10px 0 0 0;}
    .slideshow-dot { width: 13px; height: 13px; background: #b4d7ff; border-radius: 7px; border: 2px solid #b993d6; box-shadow: 0 2px 7px #b993d64a; cursor: pointer; transition: background .16s; opacity: 0.59;}
    .slideshow-dot.active { background: #fd90d7; opacity: 1;}
    /* VIDEO/CHAPTER */
    .chapter-video { width: 99%; max-width: 720px; aspect-ratio: 16/9; background: #ddd; border-radius: 13px; box-shadow: 0 3px 13px #b993d63c; border: 5px solid #b993d6; margin: 0 auto 18px auto; display: block; transition: height .3s, width .3s;}
    .chapter-btns { display: flex; gap: 15px; margin: 9px auto 0 auto; justify-content: center; align-items: center;}
    .main-btn {
      background: var(--blue-btn); color: #234078;
      border: none; font-size: 1.13rem; font-weight: 700; border-radius: 15px;
      box-shadow: 0 2px 11px #bdd6ff1c;
      padding: 0.8em 2.2em; margin: 0; outline: none;
      cursor: pointer; transition: background .14s, color .14s, transform .11s; letter-spacing: .01em;
      min-width: 7em; display: flex; align-items: center; justify-content: center; position: relative;
    }
    .main-btn:active { background: #fd90d7; color: #fff; transform: scale(1.07);}
    .main-btn .btn-check { margin-left: 9px;}
    .main-btn .btn-check svg { width: 17px; height: 17px; vertical-align: -3px;}
    /* Levels & Chapters */
    .levels-area { flex: 1 1 0; width: 100vw; max-width: 100vw; min-height: 0; background: none; display: flex; flex-direction: column; align-items: center; overflow: hidden;}
    .levels-scroll-area { width: 99vw; max-width: 580px; margin: 0 auto; padding: 8px 0 26px 0; overflow-y: auto; flex: 1; height: 100%; scrollbar-width: thin; scrollbar-color: var(--scrollbar) var(--scrollbar-bg);}
    .levels-scroll-area::-webkit-scrollbar { width: 6px; background: var(--scrollbar-bg);}
    .levels-scroll-area::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 7px;}
    .levels-scroll-area::-webkit-scrollbar-track { background: var(--scrollbar-bg);}
    .level-card { background: var(--level-folded); border-radius: 21px; margin: 14px 0; box-shadow: 0 2px 12px #e5d3ff23; padding: 0 0 7px 0; width: 97%; max-width: 520px; transition: background .16s, box-shadow .13s; position: relative;}
    .level-card.open { background: var(--level-open);}
    .level-header-row { display: flex; align-items: center; height: 48px; cursor: pointer; font-size: 1.22rem; font-weight: 800; color: #668cff; padding: 0 17px; border-radius: 24px 24px 0 0; transition: background .13s, color .13s; position: relative; user-select: none; min-height: 48px;}
    .level-card.open .level-header-row { color: #fff;}
    .level-icon { width: 24px; height: 24px; margin-right: 13px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 1.43em; box-shadow: 0 2px 7px #8ca6db2b;}
    .level-name { font-weight: 700; margin-right: 8px; letter-spacing: 0.01em; flex-shrink: 0;}
    .level-progress { flex: 1; margin: 0 0 0 10px; height: 8.7px; background: #ede3ff; border-radius: 7px; max-width: 110px; position: relative; display: flex; align-items: center;}
    .level-progress-bar { background: linear-gradient(90deg,#ffe066 30%,#28cb76 100%); height: 100%; border-radius: 7px; transition: width .4s cubic-bezier(.71,1.14,.53,.93); box-shadow: 0 1px 4px #ffd70036;}
    .level-arrow { margin-left: 14px; font-size: 1.43rem; color: #8ca6db; transition: transform .15s; user-select: none;}
    .level-card.open .level-arrow { color: #fff;}
    .level-card.closed .level-arrow { transform: rotate(90deg);}
    .chapters-list { width: 96%; margin: 0 auto 0 auto; display: flex; flex-direction: column; gap: 8px; max-height: 210px; overflow-y: auto; transition: max-height .25s; padding: 3px 0 8px 0; scrollbar-width: thin; scrollbar-color: var(--scrollbar) var(--scrollbar-bg);}
    .chapters-list::-webkit-scrollbar { width: 4px; background: var(--scrollbar-bg);}
    .chapters-list::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 7px;}
    .chapter-row { display: flex; align-items: center; justify-content: space-between; background: #fff; border-radius: 12px; box-shadow: 0 1px 7px #b993d629; padding: 0.52em 1em; font-size: 1.08rem; font-weight: 700; margin: 0; border: 1.7px solid #b4d7ff; color: #668cff; transition: background .13s, color .13s, border .12s, transform .12s; cursor: pointer; min-height: 33px; position: relative;}
    .chapter-row.completed { color: #28cb76; border: 1.7px solid #28cb76;}
    .chapter-row.active, .chapter-row.unlocked:hover, .chapter-row.unlocked:focus { background: var(--chapter-selected); color: #e6689c; border: 1.8px solid #fd90d7; transform: scale(1.03);}
    .chapter-row .chapter-check { margin-left: 7px; width: 18px; height: 18px; display: flex; align-items: center; justify-content: center; color: var(--chapter-check);}
    /* Responsive */
    @media (max-width: 750px) {
      .top-content-area { max-width: 99vw;}
      .levels-scroll-area { max-width: 99vw;}
      .level-card { max-width: 97vw;}
      .chapter-video { max-width: 98vw;}
    }
    @media (max-width: 500px) {
      .fixed-top { min-height: 53vw; max-height: 58vw;}
      .top-content-area { border-radius: 0 0 15px 15px; padding: 7px 0vw 7px 0vw; margin: 50px auto 0 auto; min-height: 43vw;}
      .chapter-video { height: 34vw !important; }
      .levels-scroll-area { max-width: 100vw;}
      .level-card { max-width: 100vw;}
    }
    /* Fullscreen mode (body.fullscreen) */
    body.fullscreen, body.fullscreen .fixed-top { min-height: 100vh !important; height: 100vh !important; max-height: 100vh !important; }
    body.fullscreen .top-content-area { height: 98vh !important; min-height: 85vh !important; max-width: 100vw; border-radius: 0; margin: 0 auto;}
    body.fullscreen .chapter-video { width: 99vw; max-width: 99vw; height: 60vw !important; max-height: 79vh;}
    body.fullscreen .levels-area { display: none !important;}
    body.fullscreen .topbar-btns { top: 15px; right: 16px;}
    /* Settings modal */
    #settingsModal {
      display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; z-index:1000; background:#0004;
    }
    .settings-box {
      background: #fff; padding: 1.5em 1.5em 1.1em 1.5em; min-width:300px; max-width:340px; border-radius:18px;
      box-shadow: 0 4px 40px #b993d658; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      display: flex; flex-direction: column; gap: 1.3em; align-items:center;
    }
    body.dark .settings-box { background: var(--dark-light);}
    .settings-title {
      font-weight:800; font-size:1.3em; color:#8d79c9; margin-bottom:0.7em; text-align:center; width: 100%;
    }
    body.dark .settings-title { color:var(--dark-text);}
    .settings-x {
      position: absolute; top: 1.1em; right: 1.4em; background: none; border: none; font-size: 1.9em; color: #b993d6; cursor: pointer; z-index: 3;
      border-radius: 50%; padding: 0 0.2em;
      transition: background .12s;
    }
    .settings-x:active { background: #f5e8fd;}
    .settings-row {
      width: 100%; display: flex; align-items: center; justify-content: space-between; gap: 1em;
    }
    .settings-row label { font-size: 1.09rem; color: #7785d7; font-weight: 700;}
    body.dark .settings-row label { color: #ffe066;}
    .settings-box select, .settings-box button, .settings-box input[type="range"] {
      background: #e2eefd; color: #4d528e; border-radius: 1.2em; box-shadow: 0 3px 14px #bdd6ff14; font-size: 1.07rem;
      font-weight: 700; border: none; padding: 0.43em 1.1em; margin-left: 0.3em; outline: none; cursor: pointer; min-width: 2.8em;
      transition: background .12s, color .12s;
    }
    .settings-box select:active, .settings-box button:active, .settings-box input[type="range"]:active { background: #b4d7ff; color: #fff;}
    .settings-logout { margin: 0.7em 0 0 0; width: 100%; text-align: center;}
    .settings-logout-btn { background: #fd90d7; color: #fff; font-size: 1.1em; padding: 0.7em 2.6em; border-radius: 15px; border: none; box-shadow: 0 2px 10px #fd90d748; cursor: pointer; margin: 0 auto;}
    .settings-logout-btn:active { background: #ff4786;}
  </style>
</head>
<body>
  <div class="fixed-top">
    <div class="topbar-btns">
      <button class="icon-btn" id="settingsBtn" title="Settings">
        <svg viewBox="0 0 24 24"><g><circle cx="12" cy="12" r="9" fill="#b993d6"/><path d="M12 8.5a3.5 3.5 0 100 7 3.5 3.5 0 000-7zm0 5.4a1.9 1.9 0 110-3.8 1.9 1.9 0 010 3.8z" fill="#fff"/></g></svg>
      </button>
      <button class="icon-btn" id="fullscreenBtn" title="Full Screen">
        <svg viewBox="0 0 24 24"><rect x="3.5" y="3.5" width="6" height="2" rx="1" fill="#6cc2ff"/><rect x="3.5" y="3.5" width="2" height="6" rx="1" fill="#6cc2ff"/><rect x="14.5" y="3.5" width="6" height="2" rx="1" fill="#6cc2ff"/><rect x="18.5" y="3.5" width="2" height="6" rx="1" fill="#6cc2ff"/><rect x="3.5" y="18.5" width="6" height="2" rx="1" fill="#6cc2ff"/><rect x="3.5" y="14.5" width="2" height="6" rx="1" fill="#6cc2ff"/><rect x="14.5" y="18.5" width="6" height="2" rx="1" fill="#6cc2ff"/><rect x="18.5" y="14.5" width="2" height="6" rx="1" fill="#6cc2ff"/></svg>
      </button>
    </div>
    <div class="top-content-area" id="topContentArea"><div id="topContent"></div></div>
  </div>
  <div class="levels-area">
    <div class="levels-scroll-area" id="levelsScrollArea"></div>
  </div>
  <!-- Settings Modal -->
  <div id="settingsModal">
    <div class="settings-box">
      <button class="settings-x" onclick="closeSettings()">&times;</button>
      <div class="settings-title">Settings</div>
      <div class="settings-row">
        <label>Font Size</label>
        <input id="fontSizeSlider" type="range" min="0.95" max="1.25" step="0.01" value="1" />
      </div>
      <div class="settings-row">
        <label>Dark Mode</label>
        <input type="checkbox" id="darkModeSwitch" style="width:26px;height:26px;border-radius:15px;"/>
      </div>
      <div class="settings-row">
        <label>Language</label>
        <select id="langSelect">
          <option value="en">English</option>
          <option value="th">à¹„à¸—à¸¢</option>
          <option value="zh">ä¸­æ–‡</option>
        </select>
      </div>
      <div class="settings-logout">
        <button class="settings-logout-btn" onclick="logout()">Log out</button>
      </div>
    </div>
  </div>
  <script>
    // --- Level data: 10 levels, level 1=20 chapters, rest=10, all unlocked, session progress
    const bookIcons = [
      {color:'#5bb3ff',icon:'ðŸ“˜'},
      {color:'#6ccc88',icon:'ðŸ“—'},
      {color:'#ef7d67',icon:'ðŸ“•'},
      {color:'#ffe066',icon:'ðŸ“™'},
      {color:'#fd90d7',icon:'ðŸ“’'},
      {color:'#b993d6',icon:'ðŸ“š'},
      {color:'#f0af54',icon:'ðŸ“”'},
      {color:'#70d8eb',icon:'ðŸ“–'},
      {color:'#a685e2',icon:'ðŸ““'},
      {color:'#f7c873',icon:'ðŸ“™'}
    ];
    const levelData = [];
    for(let i=1;i<=10;i++) {
      const nCh = i===1?20:10;
      let chArr = [];
      for(let j=0;j<nCh;j++){
        chArr.push({
          title:'Chapter '+(j+1),
          videoWatched:false,
          exerciseDone:false
        });
      }
      levelData.push({
        name:'Level '+i,
        chapters:chArr,
        progress:0, open:i===1
      });
    }

    // -- Slides for welcome
    const slides=[
      "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?auto=format&fit=crop&w=600&q=80",
      "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?auto=format&fit=crop&w=600&q=80",
      "https://images.unsplash.com/photo-1503676382389-4809596d5290?auto=format&fit=crop&w=600&q=80"
    ];
    let slideIdx=0;
    let selected={level:0,chapter:0},showingChapter=false;
    // -- Try to restore progress
    if(sessionStorage.getItem('wkprogress')){
      const saved=JSON.parse(sessionStorage.getItem('wkprogress'));
      for(let i=0;i<levelData.length;i++)
        for(let j=0;j<levelData[i].chapters.length;j++)
          if(saved[i]&&saved[i][j])
            Object.assign(levelData[i].chapters[j],saved[i][j]);
    }

    // -- Top area rendering
    function renderTop(){
      const tc=document.getElementById('topContent');
      tc.innerHTML='';
      if(!showingChapter){
        tc.innerHTML=`
          <div class="top-title">Welcome to Wonder Kids!</div>
          <div class="slideshow-img-area">
            ${slides.map((src,i)=>`<img src="${src}" class="slideshow-img${i===slideIdx?' active':''}" id="slideImg${i}"/>`).join('')}
          </div>
          <div class="slideshow-dots">
            ${slides.map((_,i)=>`<span class="slideshow-dot${i===slideIdx?' active':''}" onclick="goSlide(${i})"></span>`).join('')}
          </div>
        `;
      }else{
        const lvl=levelData[selected.level], ch=lvl.chapters[selected.chapter];
        tc.innerHTML=`
          <div class="top-title">${lvl.name} - ${ch.title}</div>
          <iframe class="chapter-video" id="chapterVideo" src="https://www.youtube.com/embed/K91CRNQg2dg" allowfullscreen onload="chapterWatched()"></iframe>
          <div class="chapter-btns">
            <button class="main-btn" onclick="goExercise()">EXERCISE${ch.exerciseDone?'<span class="btn-check">'+checkSvg()+'</span>':''}</button>
            ${selected.chapter<lvl.chapters.length-1?'<button class="main-btn" onclick="goNextChapter()">NEXT</button>':''}
          </div>
        `;
        // Mark video as watched when video is visible
        setTimeout(()=>chapterWatched(),300);
      }
    }
    function chapterWatched(){
      if(!showingChapter) return;
      let ch=levelData[selected.level].chapters[selected.chapter];
      if(!ch.videoWatched){
        ch.videoWatched=true;
        updateProgress(); renderLevels();
        saveProgress();
      }
    }
    // -- Check SVG
    function checkSvg(){return `<svg width="17" height="17" viewBox="0 0 17 17"><circle cx="8.5" cy="8.5" r="8" fill="#28cb76"/><path d="M5.1 8.6l2 2 5-5" stroke="#fff" stroke-width="2.1" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>`;}
    // -- Slideshow
    window.goSlide=i=>{slideIdx=i; renderTop();}
    setInterval(()=>{if(!showingChapter){slideIdx=(slideIdx+1)%slides.length;renderTop();}},5000);

    // -- Levels/chapters rendering
    function renderLevels(){
      // Calculate progress
      for(let i=0;i<levelData.length;i++){
        let lvl=levelData[i];
        const n=lvl.chapters.length;
        const nDone=lvl.chapters.filter(c=>c.videoWatched&&c.exerciseDone).length;
        lvl.progress=nDone/n;
      }
      // Render levels/chapters
      const area=document.getElementById('levelsScrollArea');
      area.innerHTML='';
      for(let i=0;i<levelData.length;i++){
        const lvl=levelData[i],book=bookIcons[i%bookIcons.length];
        area.innerHTML+=`
          <div class="level-card${lvl.open?' open':' closed'}" id="levelCard${i}">
            <div class="level-header-row" onclick="toggleLevel(${i})" style="background:${lvl.open?book.color:'#e4f1ff'};">
              <span class="level-icon" style="background:${book.color};">${book.icon}</span>
              <span class="level-name">${lvl.name}</span>
              <span class="level-progress"><span class="level-progress-bar" style="width:${Math.round(lvl.progress*100)}%;"></span></span>
              <span class="level-arrow">${lvl.open?'â–´':'â–¾'}</span>
            </div>
            <div class="chapters-list" id="chaptersList${i}" style="display:${lvl.open?'flex':'none'};">
              ${lvl.chapters.map((ch,j)=>{
                let classes="chapter-row";
                if(showingChapter&&selected.level===i&&selected.chapter===j) classes+=' active';
                if(ch.videoWatched&&ch.exerciseDone) classes+=' completed';
                else classes+=' unlocked';
                return `<div class="${classes}" onclick="selectChapter(event,${i},${j})">
                  <span>${ch.title}</span>
                  ${(ch.videoWatched&&ch.exerciseDone)?`<span class="chapter-check">${checkSvg()}</span>`:''}
                </div>`;
              }).join('')}
            </div>
          </div>
        `;
      }
    }
    window.toggleLevel=function(i){
      for(let j=0;j<levelData.length;j++){
        levelData[j].open=(j===i)?!levelData[j].open:false;
        document.getElementById('chaptersList'+j).style.display=levelData[j].open?'flex':'none';
        document.getElementById('levelCard'+j).className='level-card'+(levelData[j].open?' open':' closed');
      }
    };
    window.selectChapter=function(e,li,ci){
      showingChapter=true; selected={level:li,chapter:ci};
      renderTop(); renderLevels(); e.stopPropagation();
    };
    // -- EXERCISE (open quiz.html)
    window.goExercise=function(){
      let ch=levelData[selected.level].chapters[selected.chapter];
      ch.exerciseDone=true;
      updateProgress(); renderLevels(); renderTop();
      saveProgress();
      window.open('sorobanquiz.html','_blank');
    }
    // -- NEXT button
    window.goNextChapter=function(){
      const {level:l,chapter:c}=selected;
      if(levelData[l].chapters[c+1]) {
        selected={level:l,chapter:c+1}; showingChapter=true;
        renderTop(); renderLevels();
        document.querySelector(`#levelCard${l} .chapters-list`).scrollTo({top: 44*(c+1)-16,behavior:'smooth'});
      }
    }
    function updateProgress(){ /* nothing needed, logic is live in renderLevels() */ }
    function saveProgress(){
      let d=levelData.map(lvl=>lvl.chapters.map(ch=>({videoWatched:ch.videoWatched,exerciseDone:ch.exerciseDone})));
      sessionStorage.setItem('wkprogress',JSON.stringify(d));
    }
    // --- Fullscreen logic
    document.getElementById('fullscreenBtn').onclick=()=>{
      if(!document.fullscreenElement){
        document.documentElement.requestFullscreen();
        document.body.classList.add('fullscreen');
      }else{
        document.exitFullscreen();
        document.body.classList.remove('fullscreen');
      }
    };
    document.addEventListener('fullscreenchange',()=>{
      if(!document.fullscreenElement) document.body.classList.remove('fullscreen');
      else document.body.classList.add('fullscreen');
    });
    // -- Auto full-video on horizontal mobile/tablet
    function updateOrientation(){
      if(window.matchMedia("(orientation: landscape)").matches && window.innerWidth<850){
        // landscape on mobile/tablet: full video only
        document.body.classList.add('fullscreen');
      }else{
        document.body.classList.remove('fullscreen');
      }
    }
    window.addEventListener('orientationchange',updateOrientation);
    window.addEventListener('resize',updateOrientation);

    // --- Settings modal logic
    document.getElementById('settingsBtn').onclick=()=>{document.getElementById('settingsModal').style.display='block';};
    function closeSettings(){document.getElementById('settingsModal').style.display='none';}
    document.getElementById('fontSizeSlider').oninput=e=>{
      document.documentElement.style.fontSize = e.target.value+'rem';
      sessionStorage.setItem('wkfontsize',e.target.value);
    };
    document.getElementById('darkModeSwitch').onchange=e=>{
      document.body.classList.toggle('dark',e.target.checked);
      sessionStorage.setItem('wkdark',e.target.checked?'1':'0');
    };
    document.getElementById('langSelect').onchange=e=>{
      sessionStorage.setItem('wklang',e.target.value);
      // You can add logic for language switch here
    };
    function logout(){
      sessionStorage.clear();
      window.location.reload();
    }
    // --- Restore settings
    if(sessionStorage.getItem('wkfontsize')) document.documentElement.style.fontSize=sessionStorage.getItem('wkfontsize')+'rem';
    if(sessionStorage.getItem('wkdark')==='1'){ document.body.classList.add('dark'); document.getElementById('darkModeSwitch').checked=true;}
    if(sessionStorage.getItem('wklang')) document.getElementById('langSelect').value=sessionStorage.getItem('wklang');

    // --- On load
    window.onload=()=>{
      renderTop(); renderLevels(); updateOrientation();
    };
  </script>
</body>
</html>
