<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Soroban Quiz</title>
  <style>
    html, body {
      margin: 0; padding: 0;
      width: 100vw; height: 100vh;
      display: flex; flex-direction: row;
      font-family: sans-serif;
      background: #b3c4e7;
      overflow: hidden;
    }
    #quizPanel {
      width: clamp(260px, 24vw, 360px);
      height: 100vh;
      background: rgba(140,166,219,0.95);
      color: #fff;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      z-index: 10;
    }
    #resultsPanel {
      display: none;
      flex-direction: column;
      width: clamp(260px, 24vw, 360px);
      height: 100vh;
      background: #f6f9ff;
      color: #222;
      padding: 1rem;
      overflow-y: auto;
      box-sizing: border-box;
      z-index: 10;
    }
    #abacusRoot {
      flex: 1;
      background: #4d79ff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .question { font-size: 1.3rem; font-weight: bold; margin-bottom: 1rem; }
    #answerDisplay {
      padding: 0.6rem;
      font-size: 1.2rem;
      background: #fff;
      border: 2px solid #b993d6;
      border-radius: 0.4rem;
      text-align: right;
      color: #222;
    }
    #numpad {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.5rem;
      margin-top: 1rem;
    }
    #numpad button {
      padding: 0.8rem;
      font-size: 1.1rem;
      background: #668cff;
      color: #fff;
      border: none;
      border-radius: 0.4rem;
      font-weight: bold;
    }
    #sendBtn {
      background: #668cff;
      color: white;
      border: none;
      padding: 0.6rem 1.2rem;
      border-radius: 0.4rem;
      font-weight: bold;
      cursor: pointer;
      margin-top: 1rem;
    }
    #quizTimer {
      text-align: center;
      font-weight: bold;
      margin-top: auto;
    }
    .result-item {
      margin: 0.5rem 0;
      font-size: 1rem;
    }
    .result-item .mark { font-weight: bold; margin-left: 0.4rem; }
    #scoreResult { margin: 1rem 0; font-size: 1.2rem; font-weight: bold; }
    #tryAgainRow { display: flex; gap: 0.7rem; justify-content: center; align-items: center; margin-top: 1rem; }
    .result-btn {
      background: #668cff;
      color: #fff;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 0.4rem;
      font-size: 1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="quizPanel">
    <div class="question" id="qText">Loading...</div>
    <div>Answer</div>
    <div style="display: flex; gap: 0.5rem; align-items: center;">
      <div id="answerDisplay">0</div>
      <button id="sendBtn">Send</button>
    </div>
    <div id="numpad"></div>
    <div id="quizTimer">Time Left: 10:00</div>
  </div>

  <div id="resultsPanel">
    <h2>Results</h2>
    <div id="resultsList"></div>
    <div id="scoreResult"></div>
    <div id="tryAgainRow">
      <button id="fullscreenBtnResults" class="result-btn">⛶</button>
      <button id="tryAgainBtn" class="result-btn">Try Again</button>
    </div>
  </div>

  <div id="abacusRoot">
    <!-- This will be replaced by the original functional soroban implementation you had before -->
    <!-- Keep the soroban.html code block from your working version and embed here directly. -->
  </div>

  <script>
    const QUESTIONS = [
      { q: '9 × 25', a: '225' }, { q: '120 + 4', a: '124' }, { q: '250 - 10', a: '240' },
      { q: '13 + 17', a: '30' }, { q: '5 × 9', a: '45' }, { q: '90 - 40', a: '50' },
      { q: '3 + 4 + 2', a: '9' }, { q: '100 + 23', a: '123' }, { q: '80 - 15', a: '65' },
      { q: '5 × 6', a: '30' }
    ];
    let currentIndex = 0, answers = [], currentInput = '', inputLocked = false, timeLeft = 600;

    const qTextEl = document.getElementById('qText');
    const answerEl = document.getElementById('answerDisplay');
    const sendBtn = document.getElementById('sendBtn');
    const timerEl = document.getElementById('quizTimer');
    const pad = document.getElementById('numpad');
    const resultsPanel = document.getElementById('resultsPanel');
    const quizPanel = document.getElementById('quizPanel');

    function loadQuestion() {
      const q = QUESTIONS[currentIndex];
      qTextEl.textContent = `${q.q} =`;
      currentInput = '';
      inputLocked = false;
      answerEl.textContent = '0';
    }
    function updateTimer() {
      const m = String(Math.floor(timeLeft / 60)).padStart(2, '0');
      const s = String(timeLeft % 60).padStart(2, '0');
      timerEl.textContent = `Time Left: ${m}:${s}`;
    }
    function appendDigit(d) {
      if (inputLocked) return;
      if (d === 'C') currentInput = '';
      else if (d === 'BACK') currentInput = currentInput.slice(0, -1);
      else currentInput += d;
      answerEl.textContent = currentInput || '0';
    }
    function submitAnswer() {
      if (inputLocked || currentInput === '') return;
      inputLocked = true;
      answers.push({ question: QUESTIONS[currentIndex].q, correct: QUESTIONS[currentIndex].a, user: currentInput });
      currentIndex++;
      if (currentIndex < QUESTIONS.length) setTimeout(loadQuestion, 300);
      else showResults();
    }
    function showResults() {
      quizPanel.style.display = 'none';
      resultsPanel.style.display = 'flex';
      const list = document.getElementById('resultsList');
      list.innerHTML = '';
      let score = 0;
      answers.forEach((a, i) => {
        const correct = a.user.trim() === a.correct;
        if (correct) score++;
        const item = document.createElement('div');
        item.className = 'result-item';
        item.innerHTML = `${i + 1}. ${a.question} =<br> Your answer: ${a.user || '0'} <span class="mark">${correct ? '✔️' : '❌'}</span>`;
        list.appendChild(item);
      });
      document.getElementById('scoreResult').textContent = `You scored ${score} / ${QUESTIONS.length}`;
    }

    document.getElementById('tryAgainBtn').onclick = () => location.reload();
    document.getElementById('fullscreenBtnResults').onclick = () => {
      if (!document.fullscreenElement) document.documentElement.requestFullscreen();
      else document.exitFullscreen();
    };

    ['0','1','2','3','4','5','6','7','8','9','C','BACK'].forEach(d => {
      const btn = document.createElement('button');
      btn.textContent = d === 'BACK' ? '⌫' : d;
      btn.onclick = () => appendDigit(d);
      pad.appendChild(btn);
    });

    sendBtn.onclick = submitAnswer;
    answerEl.onclick = submitAnswer;
    loadQuestion();
    updateTimer();
    setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) showResults();
    }, 1000);
  </script>
</body>
</html>
